<!-- <!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Preview & Edit Extracted Text</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">

  <div class="container py-5">
    <div class="text-center mb-4">
      <h2 class="fw-bold">üìÑ Preview & Edit Extracted Text</h2>
      <p class="text-muted">You can review and edit the text before downloading it as a Word document.</p>
    </div>

    <form action="/download" method="POST">
      {% for title, text in content %}
      <div class="card mb-4 shadow-sm">
        <div class="card-header bg-dark text-white fw-semibold">{{ title }}</div>
        <div class="card-body">
          <textarea class="form-control" name="text_{{ loop.index }}" rows="6">{{ text }}</textarea>
        </div>
      </div>
      {% endfor %}
      <button type="submit" class="btn btn-success w-100">üíæ Download as Word Document</button>
    </form>
  </div>

</body>
</html>  -->

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Edit Extracted Text</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
  <script src="content.bundle.js"></script>

  <script src="{{ url_for('static', filename='js/content.bundle.js') }}"></script>

  <style>
    mark {
      background-color: yellow;
    }
    textarea.form-control {
      white-space: pre-wrap;
      min-height: 150px;
    }
  </style>
</head>
<body>
  <div class="container py-5">
    <h2 class="mb-4 text-center">Review and Edit Extracted Text</h2>

    <!-- üîç Search + Navigation UI -->
    <div class="row align-items-center mb-4">
      <div class="col-md-4 col-12 mb-2 mb-md-0">
        <input type="text" id="searchInput" class="form-control" placeholder="Enter word to search" />
      </div>
      <div class="col-md-2 col-4 d-grid">
        <button class="btn btn-primary" onclick="highlightAndScroll()">Search</button>
      </div>
      <div class="col-md-2 col-4 d-grid">
        <button class="btn btn-outline-secondary" onclick="navigateMatch(-1)">‚¨ÜÔ∏è</button>
      </div>
      <div class="col-md-2 col-4 d-grid">
        <button class="btn btn-outline-secondary" onclick="navigateMatch(1)">‚¨áÔ∏è</button>
      </div>
      <div class="col-md-2 col-12 text-md-end mt-2 mt-md-0">
        <span id="matchCount" class="fw-bold text-success"></span>
      </div>
    </div>

    <div id="noMatchAlert" class="alert alert-danger d-none" role="alert">
      No match found! Please check your spelling.
    </div>

    <form action="/download" method="POST">
      {% for title, text in content %}
        <div class="mb-4">
          <label class="form-label fw-bold">{{ title }}</label>
          <textarea rows="20" cols="60" name="text_{{ loop.index }}" class="form-control editable-text">{{ text }}</textarea>
        </div>
      {% endfor %}
      <button type="submit" class="btn btn-success w-100">Download as Word</button>
    </form>
  </div>

  <script>
    let allMatches = [];
    let currentMatchIndex = -1;

    function highlightAndScroll() {
      const keyword = document.getElementById("searchInput").value.trim().toLowerCase();
      const alertBox = document.getElementById("noMatchAlert");
      const matchCountBox = document.getElementById("matchCount");
      allMatches = [];
      currentMatchIndex = -1;

      if (!keyword) {
        alertBox.classList.add("d-none");
        matchCountBox.textContent = "";
        return;
      }

      const areas = document.querySelectorAll(".editable-text");
      areas.forEach((area) => {
        const text = area.value;
        const regex = new RegExp(`(${keyword})`, "gi");
        const matches = [...text.matchAll(regex)];

        allMatches.push(...matches.map((_, idx) => ({ index: idx, element: area })));
      });

      if (allMatches.length > 0) {
        alertBox.classList.add("d-none");
        matchCountBox.textContent = `${allMatches.length} matches found`;
        currentMatchIndex = 0;
        scrollToMatch(currentMatchIndex);
      } else {
        alertBox.classList.remove("d-none");
        matchCountBox.textContent = "";
      }
    }

    function scrollToMatch(index) {
      if (allMatches.length === 0) return;
      const match = allMatches[index];
      const textArea = match.element;

      textArea.focus();
      const keyword = document.getElementById("searchInput").value.trim().toLowerCase();
      const text = textArea.value.toLowerCase();
      const matchIndex = text.indexOf(keyword, match.index);
      if (matchIndex !== -1) {
        textArea.setSelectionRange(matchIndex, matchIndex + keyword.length);
      }
    }

    function navigateMatch(direction) {
      if (allMatches.length === 0) return;
      currentMatchIndex += direction;
      if (currentMatchIndex < 0) currentMatchIndex = allMatches.length - 1;
      if (currentMatchIndex >= allMatches.length) currentMatchIndex = 0;
      scrollToMatch(currentMatchIndex);
    }

  </script>
  <script>
  console.log("My script is working!");
</script>
</body>
</html>








